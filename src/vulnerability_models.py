"""
ENEO Asteroid Impact Simulation - Vulnerability Models Module

This module contains mathematical models for calculating human population vulnerability
to various asteroid impact effects. Each vulnerability function returns a value between
0.0 (no vulnerability) and 1.0 (complete vulnerability/fatality) for a given impact parameter.

The vulnerability models are based on peer-reviewed research by C. Rumpf and colleagues,
incorporating data from various sources including Glasstone 1977, Wu2015, NOAA, and the
American Burn Association.

Reference: "Population Vulnerability Models for Asteroid Impact Risk Assessment," 
           Meteorit. Planet. Sci., vol. 52, no. 6, pp. 1082â€“1102, 2017.
"""

import numpy as N  # Using N alias for numpy to maintain consistency with original implementation

# =============================================================================
# VULNERABILITY MODELS
# =============================================================================
def fun_CraterVulnerability(dist_m, final_crater_diam):
    crater_radius = final_crater_diam / 2.0
    
    if dist_m <= crater_radius:
        vuln_crater = 1.0
    else:
        vuln_crater = 0.0
        
    return vuln_crater

def fun_SeismicVulnerability(eff_mag):
    vuln_seis = 1. / (1. + N.exp(-2.51607678 * (eff_mag - 8.68559246)))
    if vuln_seis > 1.0:
         vuln_seis = 1.0
    elif vuln_seis < 0.0 or eff_mag < 4.5:
         vuln_seis = 0.0
        
    return vuln_seis
    
def fun_OverpressureVulnerability(press):
    if press <= 150000.0:
        vuln_press = 0.0
    elif press >= 900000.0:
        vuln_press = 1.0
    else:
         vuln_press = 1. / (1. + N.exp(-(press-440430.986)*0.0000242498102))
         if vuln_press > 1.0:
             vuln_press = 1.0
         elif vuln_press < 0.0:
             vuln_press = 0.0
         
    return vuln_press
    
def fun_ThermRadVulnerability(phi):
    vuln_therm = 0.47 * ( 1. / (1. + N.exp( -0.00000562326741 * ( phi - 731641.664 ))))
    if phi < 85000.0 or vuln_therm < 0.0:
        vuln_therm = 0.0
    elif vuln_therm > 1.0:
        vuln_therm = 1.0
        
    return vuln_therm
    
def fun_HighWindVulnerability(v_wind):
    vuln_wind = 1. / (1. + N.exp(-(v_wind-1.12444654e+02)*5.48261521e-02))

    if v_wind < 10. or vuln_wind < 0.0:
        vuln_wind = 0.0
    elif vuln_wind > 1.0 or v_wind > 250.:
        vuln_wind = 1.0
        
    return vuln_wind
    
def fun_EjectaBlanketVulnerability(t_ejecta):
    ejecta_load_kPa = t_ejecta * 1.6 * 9.80655 # thickness * density[t/m3] * g_0
    P_collapse = (1.0 + N.exp(-1.37*(ejecta_load_kPa-3.14)))**(-4.6)    
    vuln_ejecta = 0.078 * P_collapse

    if vuln_ejecta < 0.0 or t_ejecta < 0.001:
        vuln_ejecta = 0.0
    elif vuln_ejecta > 1.0:
        vuln_ejecta = 1.0
        
    return vuln_ejecta
